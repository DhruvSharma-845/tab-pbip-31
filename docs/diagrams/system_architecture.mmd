%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4A90A4', 'secondaryColor': '#F5A623', 'tertiaryColor': '#7ED321'}}}%%
flowchart TB
    subgraph INPUT["üì• INPUT LAYER"]
        TWBX["üì¶ TWBX Package<br/>.twbx / .twb"]
        IMAGES["üñºÔ∏è Dashboard Snapshots<br/>PNG / SVG"]
        TEMPLATE["üìã Sample PBIP Template<br/>samplepbipfolder"]
    end

    subgraph EXTRACTION["üîç EXTRACTION LAYER"]
        XML_PARSER["üîß TWB XML Parser<br/>‚Ä¢ Datasources<br/>‚Ä¢ Calculations<br/>‚Ä¢ Worksheets<br/>‚Ä¢ Relationships"]
        VISION["üëÅÔ∏è Vision Model<br/>‚Ä¢ Chart detection<br/>‚Ä¢ Layout analysis<br/>‚Ä¢ Color extraction<br/>‚Ä¢ Label parsing"]
        LOADER["üìÇ Template Loader<br/>‚Ä¢ Schema refs<br/>‚Ä¢ Visual templates<br/>‚Ä¢ TMDL patterns"]
    end

    subgraph TRANSFORM["‚öôÔ∏è TRANSFORMATION LAYER"]
        subgraph SEMANTIC["Semantic Model Generator"]
            SM1["Datasource ‚Üí TMDL Tables"]
            SM2["Calculations ‚Üí DAX"]
            SM3["Relationships ‚Üí Model"]
            SM4["Parameters ‚Üí Calc Groups"]
        end
        subgraph REPORT["Report Generator"]
            RG1["Dashboards ‚Üí Pages"]
            RG2["Worksheets ‚Üí Visuals"]
            RG3["Filters ‚Üí Slicers"]
            RG4["Actions ‚Üí Drill-through"]
        end
    end

    subgraph OUTPUT["üì§ OUTPUT LAYER"]
        PBIP["üìÑ Project.pbip"]
        subgraph REPORT_OUT["Project.Report/"]
            PBIR["definition.pbir"]
            REPORT_JSON["report.json"]
            PAGES["pages/*.json"]
            VISUALS["visuals/*.json"]
        end
        subgraph MODEL_OUT["Project.SemanticModel/"]
            PBISM["definition.pbism"]
            DATABASE["database.tmdl"]
            MODEL["model.tmdl"]
            TABLES["tables/*.tmdl"]
        end
    end

    TWBX --> XML_PARSER
    IMAGES --> VISION
    TEMPLATE --> LOADER

    XML_PARSER --> SEMANTIC
    XML_PARSER --> REPORT
    VISION --> REPORT
    LOADER --> SEMANTIC
    LOADER --> REPORT

    SEMANTIC --> MODEL_OUT
    REPORT --> REPORT_OUT
    REPORT_OUT --> PBIP
    MODEL_OUT --> PBIP

    classDef inputClass fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef extractClass fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef transformClass fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef outputClass fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px

    class TWBX,IMAGES,TEMPLATE inputClass
    class XML_PARSER,VISION,LOADER extractClass
    class SM1,SM2,SM3,SM4,RG1,RG2,RG3,RG4 transformClass
    class PBIP,PBIR,REPORT_JSON,PAGES,VISUALS,PBISM,DATABASE,MODEL,TABLES outputClass
